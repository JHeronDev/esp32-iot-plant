FROM influxdb:2.7-alpine

# Configuration InfluxDB
ENV DOCKER_INFLUXDB_INIT_MODE=setup
ENV DOCKER_INFLUXDB_INIT_USERNAME=${INFLUX_USER:-admin}
ENV DOCKER_INFLUXDB_INIT_PASSWORD=${INFLUX_PASSWORD:-adminpassword}
ENV DOCKER_INFLUXDB_INIT_ORG=${INFLUX_ORG:-iot_org}
ENV DOCKER_INFLUXDB_INIT_BUCKET=${INFLUX_BUCKET:-plant_data}
ENV DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=${INFLUX_TOKEN:-mytoken123456}
ENV DOCKER_INFLUXDB_INIT_RETENTION=720h
ENV DOCKER_INFLUXDB_INIT_RETENTION_NAME=autogen

# Port InfluxDB
EXPOSE 8086

# Healthcheck
HEALTHCHECK --interval=10s --timeout=5s --start-period=10s --retries=5 \
  CMD influx ping || exit 1
