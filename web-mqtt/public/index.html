<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#1e293b">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Serre ESP32">
  <title>Serre connectÃ©e</title>
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- En-tÃªte: titre + statut + authentification -->
<header>
  <h1>ğŸŒ± Serre connectÃ©e</h1>
  <div id="status">DÃ©connectÃ©</div>
  <div id="login-panel">
    <div class="login-fields is-collapsed" id="login-fields">
      <div class="login-inputs">
        <input type="text" id="username" placeholder="Utilisateur">
        <input type="password" id="password" placeholder="Mot de passe">
      </div>
    </div>
    <button class="login-btn" id="login-toggle-btn" onclick="handleLoginToggle()">Connexion</button>
    <div id="login-error"></div>
    <div id="auth-status"></div>
  </div>
</header>

<!-- Contenu principal: capteurs, paramÃ¨tres, graphique -->
<main>
  <section>
    <div class="section-header">
      <h2>Capteurs</h2>
      <button class="ghost-btn" id="settings-toggle" onclick="toggleSettingsSection()">âš™ï¸ ParamÃ¨tres</button>
    </div>
    <div id="sensors">
      <!-- Ligne 1 : Bulles des capteurs -->
      <div class="sensors-row sensors-bubbles">
        <!-- LuminositÃ© -->
        <div class="sensor-item">
          <div class="indicator">
            <div class="bubble" id="lux-bubble">
              <label>Lumi</label>
              <div class="value" id="lux">-</div>
              <div class="unit">lux</div>
            </div>
          </div>
        </div>

        <!-- HumiditÃ© Sol -->
        <div class="sensor-item">
          <div class="indicator">
            <div class="bubble" id="soil-bubble">
              <label>Sol</label>
              <div class="value" id="soil">-</div>
              <div class="unit">%</div>
            </div>
          </div>
        </div>

        <!-- HumiditÃ© Air -->
        <div class="sensor-item">
          <div class="indicator">
            <div class="bubble" id="humidity-bubble">
              <label>Air</label>
              <div class="value" id="humidity">-</div>
              <div class="unit">%</div>
            </div>
          </div>
        </div>

        <!-- TempÃ©rature -->
        <div class="sensor-item">
          <div class="indicator">
            <div class="bubble" id="temp-bubble">
              <label>Temp</label>
              <div class="value" id="temp">-</div>
              <div class="unit">Â°C</div>
            </div>
          </div>
        </div>

        <!-- Pression -->
        <div class="sensor-item">
          <div class="indicator">
            <div class="bubble" id="pressure-bubble">
              <label>Press</label>
              <div class="value" id="pressure">-</div>
              <div class="unit">hPa</div>
            </div>
          </div>
        </div>

        <!-- Niveau d'eau -->
        <div class="sensor-item">
          <div class="indicator">
            <div class="bubble" id="water-bubble">
              <label>Eau</label>
              <div class="value" id="water-level">-</div>
              <div class="unit">Ã©tat</div>
            </div>
          </div>
        </div>

        <!-- Signal RSSI -->
        <div class="sensor-item">
          <div class="indicator">
            <div class="bubble" id="rssi-bubble">
              <label>Signal</label>
              <div class="value" id="rssi">-</div>
              <div class="unit">dB</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Ligne 2 : Boutons d'action -->
      <div class="sensors-row sensors-buttons">
        <!-- LED -->
        <div class="sensor-item">
          <div class="btn-circle disabled" id="led-btn" onclick="toggle('led', 'LED')">
            <div class="icon">ğŸ’¡</div>
            <div class="label">LumiÃ¨re</div>
          </div>
          <label class="auto-toggle" for="led-auto">
            <span class="auto-toggle-label">Auto</span>
            <span class="auto-switch">
              <input type="checkbox" id="led-auto" onchange="handleAutomationToggle('led', this.checked)">
              <span class="auto-slider"></span>
            </span>
          </label>
        </div>

        <!-- Arrosage -->
        <div class="sensor-item">
          <div class="btn-circle disabled" id="hum-btn" onclick="toggle('hum', 'HUM')">
            <div class="icon">ğŸ’§</div>
            <div class="label">Arrosage</div>
          </div>
          <label class="auto-toggle" for="hum-auto">
            <span class="auto-toggle-label">Auto</span>
            <span class="auto-switch">
              <input type="checkbox" id="hum-auto" onchange="handleAutomationToggle('hum', this.checked)">
              <span class="auto-slider"></span>
            </span>
          </label>
        </div>

        <!-- Ventilation -->
        <div class="sensor-item">
          <div class="btn-circle disabled" id="fan-btn" onclick="toggle('fan', 'FAN')">
            <div class="icon">ğŸŒ€</div>
            <div class="label">Ventilation</div>
          </div>
          <label class="auto-toggle" for="fan-auto">
            <span class="auto-toggle-label">Auto</span>
            <span class="auto-switch">
              <input type="checkbox" id="fan-auto" onchange="handleAutomationToggle('fan', this.checked)">
              <span class="auto-slider"></span>
            </span>
          </label>
        </div>
      </div>
    </div>
  </section>

  <section id="settings-section">
    <h2>âš™ï¸ ParamÃ¨tres</h2>
    <h3>RÃ©glage des seuils</h3>
    <div class="settings-content">
      <div class="setting-group">
        <label>ğŸŒ LuminositÃ© (lux)</label>
        <div class="threshold-inputs">
          <input type="number" id="lux-min" placeholder="Min" min="0">
          <span class="range-sep">-</span>
          <input type="number" id="lux-max" placeholder="Max" min="0">
        </div>
      </div>

      <div class="setting-group">
        <label>ğŸ’§ HumiditÃ© du sol (%)</label>
        <div class="threshold-inputs">
          <input type="number" id="soil-min" placeholder="Min" min="0" max="100">
          <span class="range-sep">-</span>
          <input type="number" id="soil-max" placeholder="Max" min="0" max="100">
        </div>
      </div>

      <div class="setting-group">
        <label>ğŸŒ¡ï¸ TempÃ©rature (Â°C)</label>
        <div class="threshold-inputs">
          <input type="number" id="temp-min" placeholder="Min">
          <span class="range-sep">-</span>
          <input type="number" id="temp-max" placeholder="Max">
        </div>
      </div>

      <div class="setting-group">
        <label>ğŸ’¨ HumiditÃ© de l'air (%)</label>
        <div class="threshold-inputs">
          <input type="number" id="air-min" placeholder="Min" min="0" max="100">
          <span class="range-sep">-</span>
          <input type="number" id="air-max" placeholder="Max" min="0" max="100">
        </div>
      </div>

      <div class="setting-group">
        <label>ğŸ“¶ Signal RSSI (dB)</label>
        <div class="threshold-inputs">
          <input type="number" id="rssi-min" placeholder="Min">
          <span class="range-sep">-</span>
          <input type="number" id="rssi-max" placeholder="Max">
        </div>
      </div>

      <button class="save-btn" onclick="saveSettings()">ğŸ’¾ Sauvegarder</button>
    </div>
  </section>

  <section id="chart-section">
    <div class="section-header">
      <h2>ğŸ“ˆ Historique</h2>
      <div class="zoom-controls">
        <button class="zoom-btn" id="zoom-out" title="DÃ©zoomer" onclick="zoomOut()">âˆ’</button>
        <button class="zoom-btn" id="zoom-in" title="Zoomer" onclick="zoomIn()">+</button>
      </div>
    </div>
    <div id="chart-wrapper">
      <canvas id="chart"></canvas>
    </div>
  </section>
</main>

<script src="app.js"></script>
</body>
</html>
